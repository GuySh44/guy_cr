exercise 1:
-sudo apt-get install suricata jq

-edit suricata yaml to include our interface ens160 in my case
af-packet:
    - interface: ens160
      cluster-id: 99
      cluster-type: cluster_flow
      defrag: yes
      use-mmap: yes
      tpacket-v3: yes


-create new rules file:
	/etc/suricata/rules/local.rules
	
-edit it:
	alert http any any -> any any (content:"Mozilla/5.0";http_user_agent;msg: "Dont pick up the phone"; sid:777; rev:1;)
	

we alert when someone surfs to an http server with Mozilla/5.0 user agent


-run suricata:
sudo suricata -c /etc/suricata/suricata.yaml -i ens160

-we bypass it by curling/editing our user agent to something else when surfing

-we can see logs by cat /var/log/suricata/eve.json

-by piping jq 'select(.event_type == "alert")' we can view only alerts

cat /var/log/suricata/eve.json | jq 'select(.event_type == "alert")'

exercise 2:
-install docker, nginx

-edit /etc/nginx/conf.d/load-balancer.conf
  upstream backend {
    server localhost:2345/;
    server localhost:3456/;
  }
  
  server {
    listen 80;
    listen [::]:80;
    server_name localhost;
    
    location / {
      proxy_pass http://backend;
    }
  }
  
-restart nginx

-run 2 dockers:
  sudo docker run -d -p 2345:80 --name apache1 ubuntu/apache2
  sudo docker run -d -p 3456:80 --name httpd1 httpd
  
-curl localhost, each time we get to a different docker

exercise 3:

-edit /etc/nginx/conf.d/load-balancer.conf
  server {
    listen 80;
    listen [::]:80;
    server_name localhost;
    location /yarin {
      proxy_pass http://localhost:2345/;
    }
    location / {
      proxy_pass http://localhost:3456/;
    }
  }
  
-restart nginx

-run 2 dockers:
  sudo docker run -d -p 2345:80 --name apache1 ubuntu/apache2
  sudo docker run -d -p 3456:80 --name httpd1 httpd
  
-curl localhost, curl localhost/yarin get different outcomes


